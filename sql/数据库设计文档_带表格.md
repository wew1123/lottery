# 抽奖系统数据库设计文档

## 一、数据库概述

### 1. 数据库名称
`lottery_system`

### 2. 数据库类型
MySQL 5.7+

### 3. 字符集
UTF-8

### 4. 存储引擎
InnoDB（支持事务和外键）

## 二、数据库表结构

### 1. 表关系图

```
+----------------+        +----------------+        +----------------+
|   t_prize      |        |   t_result     |        |   t_user       |
+----------------+        +----------------+        +----------------+
| id (PK)        |<-------| prize_id (FK)  |        | id (PK)        |
| title          |        | user_id (FK)   |<-------| user_id        |
| prize_num      |        | prize_code     |        | user_name      |
| left_num       |        | prize_data     |        | pass_word      |
| prize_code     |        | sys_created    |        | signature      |
| prize_time     |        | sys_ip         |        |                |
| img            |        | sys_status     |        |                |
| display_order  |        |                |        |                |
| prize_type     |        |                |        |                |
| prize_profile  |        |                |        |                |
| begin_time     |        |                |        |                |
| end_time       |        |                |        |                |
| prize_plan     |        |                |        |                |
| prize_begin    |        |                |        |                |
| prize_end      |        |                |        |                |
| sys_status     |        |                |        |                |
| sys_created    |        |                |        |                |
| sys_updated    |        |                |        |                |
| sys_ip         |        |                |        |                |
+----------------+        +----------------+        +----------------+

+----------------+        +----------------+
|   t_coupon     |        |   t_black_user |
+----------------+        +----------------+
| id (PK)        |        | id (PK)        |
| prize_id (FK)  |<-------| user_id        |
| code           |        | user_name      |
| sys_created    |        | black_time     |
| sys_updated    |        | real_name      |
| sys_status     |        | mobile         |
|                |        | address        |
|                |        | sys_created    |
|                |        | sys_updated    |
|                |        | sys_ip         |
+----------------+        +----------------+

+----------------+        +----------------+
|   t_black_ip   |        | t_lottery_times|
+----------------+        +----------------+
| id (PK)        |        | id (PK)        |
| ip             |        | user_id        |
| black_time     |        | day            |
| sys_created    |        | num            |
| sys_updated    |        | sys_created    |
|                |        | sys_updated    |
+----------------+        +----------------+
```

### 2. 表详细结构

#### 2.1 t_prize - 奖品表

**功能**：存储奖品信息、数量、中奖概率等

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 奖品ID（主键）               |
| title           | varchar(255)        | NOT NULL                     | ''                         | 奖品名称                     |
| prize_num       | int(11)             | NOT NULL                     | -1                         | 奖品数量，0无限量，>0限量，<0无奖品 |
| left_num        | int(11)             | NOT NULL                     | 0                          | 剩余数量                     |
| prize_code      | varchar(50)         | NOT NULL                     | ''                         | 中奖概率区间（如"1-100"表示1%） |
| prize_time      | int(10) unsigned    | NOT NULL                     | 0                          | 发奖周期（天）               |
| img             | varchar(255)        | NOT NULL                     | ''                         | 奖品图片URL                  |
| display_order   | int(10) unsigned    | NOT NULL                     | 0                          | 位置序号（小的排在前面）     |
| prize_type      | int(10) unsigned    | NOT NULL                     | 0                          | 奖品类型：1-虚拟币，2-虚拟券，3-实物小奖，4-实物大奖 |
| prize_profile   | varchar(255)        | NOT NULL                     | ''                         | 奖品扩展数据（如虚拟币数量） |
| begin_time      | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 奖品有效周期开始时间         |
| end_time        | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 奖品有效周期结束时间         |
| prize_plan      | mediumtext          | NULL                         | NULL                       | 发奖计划（JSON格式）         |
| prize_begin     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 发奖计划周期开始时间         |
| prize_end       | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 发奖计划周期结束时间         |
| sys_status      | smallint(5) unsigned| NOT NULL                     | 1                          | 状态：1-正常，2-删除         |
| sys_created     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 创建时间                     |
| sys_updated     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 修改时间                     |
| sys_ip          | varchar(50)         | NOT NULL                     | ''                         | 操作人IP                     |

**索引**：
- PRIMARY KEY (id)

#### 2.2 t_coupon - 优惠券表

**功能**：存储优惠券编码和状态

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 优惠券ID（主键）             |
| prize_id        | int(10) unsigned    | NOT NULL                     | 0                          | 奖品ID（外键，关联t_prize）  |
| code            | varchar(255)        | NOT NULL                     | ''                         | 虚拟券编码                   |
| sys_created     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 创建时间                     |
| sys_updated     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 更新时间                     |
| sys_status      | smallint(5) unsigned| NOT NULL                     | 1                          | 状态：1-正常，2-作废，3-已发放 |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_code (code)
- KEY idx_prize_id (prize_id)

#### 2.3 t_result - 抽奖记录表

**功能**：记录用户抽奖结果和详细信息

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 抽奖记录ID（主键）           |
| prize_id        | int(10) unsigned    | NOT NULL                     | 0                          | 奖品ID（外键，关联t_prize）  |
| prize_name      | varchar(255)        | NOT NULL                     | ''                         | 奖品名称                     |
| prize_type      | int(10) unsigned    | NOT NULL                     | 0                          | 奖品类型（同t_prize.prize_type） |
| user_id         | int(10) unsigned    | NOT NULL                     | 0                          | 用户ID（外键，关联t_user）   |
| user_name       | varchar(50)         | NOT NULL                     | ''                         | 用户名                       |
| prize_code      | int(10) unsigned    | NOT NULL                     | 0                          | 抽奖编号（4位随机数）        |
| prize_data      | varchar(255)        | NOT NULL                     | ''                         | 获奖信息（如优惠券编码）     |
| sys_created     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 创建时间                     |
| sys_ip          | varchar(50)         | NOT NULL                     | ''                         | 用户抽奖的IP地址             |
| sys_status      | smallint(5) unsigned| NOT NULL                     | 1                          | 状态：1-正常，2-删除，3-作弊 |

**索引**：
- PRIMARY KEY (id)
- KEY idx_user_id (user_id)
- KEY idx_prize_id (prize_id)

#### 2.4 t_black_user - 用户黑名单表

**功能**：存储被拉黑的用户信息

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 黑名单ID（主键）             |
| user_id         | int(10) unsigned    | NOT NULL                     | 0                          | 用户ID（外键，关联t_user）   |
| user_name       | varchar(50)         | NOT NULL                     | ''                         | 用户名                       |
| black_time      | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 黑名单限制到期时间           |
| real_name       | varchar(50)         | NOT NULL                     | ''                         | 真实姓名                     |
| mobile          | varchar(50)         | NOT NULL                     | ''                         | 手机号                       |
| address         | varchar(255)        | NOT NULL                     | ''                         | 联系地址                     |
| sys_created     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 创建时间                     |
| sys_updated     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 修改时间                     |
| sys_ip          | varchar(50)         | NOT NULL                     | ''                         | IP地址                       |

**索引**：
- PRIMARY KEY (id)
- KEY idx_user_name (user_name)

#### 2.5 t_black_ip - IP黑名单表

**功能**：存储被拉黑的IP地址

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 黑名单IPID（主键）           |
| ip              | varchar(50)         | NOT NULL                     | ''                         | IP地址                       |
| black_time      | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 黑名单限制到期时间           |
| sys_created     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 创建时间                     |
| sys_updated     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 修改时间                     |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY uk_ip (ip)

#### 2.6 t_lottery_times - 用户每日抽奖次数表

**功能**：记录用户每日抽奖次数

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 抽奖次数ID（主键）           |
| user_id         | int(10) unsigned    | NOT NULL                     | 0                          | 用户ID（外键，关联t_user）   |
| day             | int(10) unsigned    | NOT NULL                     | 0                          | 日期（格式：YYYYMMDD）       |
| num             | int(10) unsigned    | NOT NULL                     | 0                          | 当日抽奖次数                 |
| sys_created     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 创建时间                     |
| sys_updated     | datetime            | NOT NULL                     | '1000-01-01 00:00:00'      | 修改时间                     |

**索引**：
- PRIMARY KEY (id)
- UNIQUE KEY idx_user_id_day (user_id, day)

#### 2.7 t_user - 用户表

**功能**：存储用户基本信息

| 字段名          | 类型                | 约束条件                     | 默认值                     | 注释说明                     |
|-----------------|---------------------|------------------------------|----------------------------|------------------------------|
| id              | int(10) unsigned    | NOT NULL AUTO_INCREMENT      | 无                         | 用户ID（主键）               |
| user_name       | varchar(50)         | NOT NULL                     | ''                         | 用户名                       |
| pass_word       | varchar(255)        | NOT NULL                     | ''                         | 用户密码（加密存储）         |
| signature       | varchar(255)        | NOT NULL                     | ''                         | 登录用户签名                 |

**索引**：
- PRIMARY KEY (id)

## 三、初始数据

### 1. 初始奖品数据

| 奖品ID | 奖品名称       | 奖品数量 | 剩余数量 | 中奖概率 | 奖品类型 |
|--------|----------------|----------|----------|----------|----------|
| 1      | T恤            | 100      | 90       | 1-100    | 3（实物小奖） |
| 2      | 360手机N8      | 10       | 9        | 0-0      | 4（实物大奖） |
| 3      | 手机充电器     | 100      | 87       | 200-1000 | 3（实物小奖） |
| 4      | 优惠券         | 1000     | 894      | 2000-5000| 2（虚拟券） |

### 2. 初始数据特点
- 每个奖品定义了不同的中奖概率
- 实物大奖有严格的发奖计划
- 优惠券有详细的发放时间点

## 四、数据库设计原则

### 1. 规范化设计
- 遵循第三范式（3NF）
- 减少数据冗余
- 提高数据一致性

### 2. 性能优化
- 合理创建索引
- 分区表设计（可选）
- 读写分离（可选）

### 3. 可扩展性
- 预留扩展字段
- 支持分库分表（可选）
- 支持数据迁移

### 4. 安全性
- 敏感信息加密存储
- 数据库访问权限控制
- 数据备份和恢复策略

## 五、数据库维护

### 1. 备份策略
- 每日全量备份
- 增量备份（可选）
- 异地备份（可选）

### 2. 监控策略
- 数据库性能监控
- 慢查询日志分析
- 存储空间监控

### 3. 优化策略
- 定期索引优化
- 数据清理和归档
- 性能调优

## 六、总结

本数据库设计采用了规范化设计原则，同时兼顾了性能和可扩展性。通过合理的表结构设计和索引优化，能够支持高并发的抽奖场景。初始数据的设计为系统提供了基础的奖品配置和发奖计划，便于系统快速启动和测试。